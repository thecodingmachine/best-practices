<!doctype html>
<!--[if lt IE 7]><html lang="en-US" prefix="og: https://ogp.me/ns#" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html lang="en-US" prefix="og: https://ogp.me/ns#" class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html lang="en-US" prefix="og: https://ogp.me/ns#" class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-US" prefix="og: https://ogp.me/ns#" class="no-js"><!--<![endif]-->
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Organize your code | TheCodingMachine Best practices</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="apple-touch-icon" sizes="57x57" href="/dist/img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/dist/img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/dist/img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/dist/img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/dist/img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/dist/img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/dist/img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/dist/img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/dist/img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/dist/img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/dist/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/dist/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/dist/img/favicon/favicon-16x16.png">

    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700,300,500" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet" type="text/css">

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/dist/img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="msapplication-TileColor" content="#f01d4f">
    <meta name="msapplication-TileImage" content="https://www.thecodingmachine.com/wp-content/themes/thecodingmachine/library/images/win8-tile-icon.png">

    <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
    <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
    </style>
                

    <link rel='stylesheet' id='font-awesome-css'  href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css' type='text/css' media='all' />
    <link rel='stylesheet' id='google-roboto-css'  href='//fonts.googleapis.com/css?family=Roboto%3A100%2C400%2C300%2C400italic%2C500%2C700' type='text/css' media='all' />
    <link rel='stylesheet' id='style-css'  href='/dist/css/style.css' type='text/css' media='all' />
    <link rel='stylesheet' id='hljstheme-css'  href='https://bestpractices.thecodingmachine.com/components/highlightjs/styles/darkula.css' type='text/css' media='all' />
    <!--[if lt IE 9]>
    <link rel='stylesheet' id='ie-only-css'  href='/dist/css/ie.css' type='text/css' media='all' />
    <![endif]-->
    <script type='text/javascript' src='https://bestpractices.thecodingmachine.com/components/jquery/dist/jquery.js'></script>
    <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js'></script>
    <script type='text/javascript' src='https://bestpractices.thecodingmachine.com/dist/js/template/script.js'></script>
    <script type='text/javascript' src='https://bestpractices.thecodingmachine.com/components/highlightjs/highlight.pack.min.js'></script>

    <script type="text/javascript">
        $ = jQuery;
        $( document ).ready(function() {
            $('.scroll-contact').on('click',function () {
                var contact = $('.b-container');
                $('html,body').animate({scrollTop: contact.offset().top}, 1500);
            });

            var wi = $(window).width();

            if(wi <= 980){
                $('#header').removeClass('absolute');
            }

            $(window).scroll(function() {
                if($(window).scrollTop() > 0) {
                    $('#header').addClass('fixed');
                }else{
                    $('#header').removeClass('fixed');
                }
            });

            // browser window scroll (in pixels) after which the "back to top" link is shown
            var offset = 300,
            //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
                    offset_opacity = 1200,
            //duration of the top scrolling animation (in ms)
                    scroll_top_duration = 700,
            //grab the "back to top" link
                    $back_to_top = $('.cd-top');

            //hide or show the "back to top" link
            $(window).scroll(function(){
                ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
                if( $(this).scrollTop() > offset_opacity ) {
                    $back_to_top.addClass('cd-fade-out');
                }
            });

            //smooth scroll to top
            $back_to_top.on('click', function(event){
                event.preventDefault();
                $('body,html').animate({
                            scrollTop: 0 ,
                        }, scroll_top_duration
                );
            });
        });
    </script>
    <style>pre.hljs {padding: 5px;}
    pre.hljs code {}</style>
    <script type="text/javascript">
        (function($, window) {
            var init_fn_flag = false;
            var init_fn = (function() {
                if (init_fn_flag)
                    return;

                init_fn_flag = true;

                hljs.configure({"tabReplace":"    "});
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });

            });

            $(document).ready(init_fn);
            $(window).on("load", init_fn);
        })(jQuery, window);
    </script>
    <script>
        jQuery(function() {
            var globalFunction = new GlobalFunction();
            globalFunction.menuInitialize();
        });
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-10196481-2', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body>

<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.3&appId=1549118041971618";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div id="wrapper" class="red">

    <header id="header">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-sm-4 col-xs-12">
                    <strong class="logo">
                        <a href="https://www.thecodingmachine.com/">
                            <img class="logo-white" src="https://bestpractices.thecodingmachine.com/dist/img/logo-final_blanc.png" alt="TheCodingMachine">
                            <img class="logo-black" src="https://bestpractices.thecodingmachine.com/dist/img/logo-final_noir.png" alt="TheCodingMachine">
                        </a>
                    </strong>
                </div>
                <!--<div class="col-md-4 col-md-push-0 col-sm-3 col-sm-push-9 col-xs-12">
                    <h2>Best practices</h2>
                </div>-->
                <div class="col-md-8 col-sm-8 col-xs-12">
                    <nav class="navbar navbar-default">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                        </div>
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav">
                                <li><a href="https://bestpractices.thecodingmachine.com/">ABOUT</a></li>
                                                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/development_environment.html">
                                                Development environment
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/defensive_programming.html">
                                                Defensive programming
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/error_handling.html">
                                                Error handling
                                            </a>
                                        </li>
                                                                                                                                                <li class="active visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/organize_your_code.html">
                                                Organize your code
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html">
                                                Design beautiful classes and methods
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/coding_style.html">
                                                Coding style
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/cli.html">
                                                Scripts and command line
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/tooling.html">
                                                Tooling
                                            </a>
                                        </li>
                                                                                                                                                                                                                    <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/libraries/curated_list.html">
                                                Curated list of libraries
                                            </a>
                                        </li>
                                                                                                                                                <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/php/libraries/doctrine.html">
                                                Doctrine
                                            </a>
                                        </li>
                                                                                                                                                                                                                    <li class=" visible-xs-block">
                                            <a href="https://bestpractices.thecodingmachine.com/git/workflow.html">
                                                Git Workflow
                                            </a>
                                        </li>
                                                                                                    <li><a href="https://www.thecodingmachine.com/">TheCodingMachine</a></li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main id="main" role="main">
        <div class="container">
            <div class="row">
                <aside id="sidebar" class="col-lg-4 col-md-4 col-sm-4 hidden-xs">
                    <div class="sidebar">
                        <div class="sidebar-holder">
                            
                                <nav id="sidebar" class="" role="navigation">

                                    <ul class="nav nav-pills nav-stacked">
                                                                                                                                    <li>
                                                    <h4>PHP</h4>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/development_environment.html">
                                                        Development environment
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/defensive_programming.html">
                                                        Defensive programming
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/error_handling.html">
                                                        Error handling
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="active">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/organize_your_code.html">
                                                        Organize your code
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html">
                                                        Design beautiful classes and methods
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/coding_style.html">
                                                        Coding style
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/cli.html">
                                                        Scripts and command line
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/tooling.html">
                                                        Tooling
                                                    </a>
                                                </li>
                                                                                                                                                                                <li>
                                                    <h4>Libraries</h4>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/libraries/curated_list.html">
                                                        Curated list of libraries
                                                    </a>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/php/libraries/doctrine.html">
                                                        Doctrine
                                                    </a>
                                                </li>
                                                                                                                                                                                <li>
                                                    <h4>Git</h4>
                                                </li>
                                                                                                                                                                                <li class="">
                                                    <a href="https://bestpractices.thecodingmachine.com/git/workflow.html">
                                                        Git Workflow
                                                    </a>
                                                </li>
                                                                                                                        </ul>

                                </nav>

                            
                        </div>
                    </div>
                </aside>

                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12 content">
                    <h1 id="0">Organize your code <small>PHP Best practices</small></h1>                    <h2 id="use-a-mvc-framework">Use a MVC framework</h2>
<p><span class="label label-success pull-right">Beginner</span></p>
<h3 id="rule">Rule</h3>
<div class="alert alert-info">Use a framework.</div>
<h3 id="explanation">Explanation</h3>
<p>Depending on the project we work on, we use different set of tools. One thing is sure however: we always use a
framework that provides a descent <strong>router</strong>.</p>
<p>There are many frameworks out there, ranging from the gigantic Symfony 6 or Zend Framework 2 to the very small
Slim 3 or Silex micro-routers.</p>
<p>In order to have a code that does not look like a spaghetti plate, you will want to organize your code using
controllers / services and a data layer.</p>
<div class="row">
<div class="col-xs-6 col-xs-offset-3 box">Request</div>
</div>
<div class="row">
<div class="col-xs-6 col-xs-offset-3 arrow-down"></div>
</div>
<div class="row">
<div class="col-xs-12 box">Controllers</div>
</div>
<div class="row">
<div class="col-xs-7 arrow-down"></div>
<div class="col-xs-5 arrow-down"></div>
</div>
<div class="row">
<div class="col-xs-6 box">Services</div>
<div class="col-xs-1 arrow-right"></div>
<div class="col-xs-5 box">DAOs / Repositories</div>
</div>
<p></p>
<ul>
<li>When a <strong>request</strong> arrives, it is routed by the framework to a <strong>controller</strong></li>
<li>The <strong>controller</strong> is in charge of analyzing the request and calling the relevant <strong>services</strong> or <strong>DAOs</strong>
(Data Access Objects, the classes in charge of communicating with the database).</li>
<li><strong>Services</strong> are objects that perform some kind of computation. It can be on the &quot;domain layer&quot; (i.e. computation
that is directly related to the code of your application - what makes your application specific - ) or it can be
purely technical services (like a mailer, a logger, etc...)</li>
<li>Finally, the controller aggregates data received from various services and calls a &quot;view&quot; that will render the
data in HTML (unless it is directly sent in another format like JSON).</li>
</ul>
<h2 id="limit-the-code-in-your-controllers">Limit the code in your controllers</h2>
<p><span class="label label-success pull-right">Beginner</span></p>
<h3 id="rule-1">Rule</h3>
<div class="alert alert-info"><strong>Limit the code in your controllers!</strong> A controller should not perform 
any kind of computation or any kind of database access. Its only role is to take the request and call the 
appropriate services. Based on the services response, it will generate the HTTP response send back to the 
browser (generally some HTML using a view, or some JSON if we are doing AJAX).</div>
<h3 id="explanation-1">Explanation</h3>
<p>Controllers are just meant to be an interface between the browser and the business logic of your application.
If you put business logic in your controller, this business logic becomes tied to a particular action.
If tomorrow, you want to call the same business logic from a command-line script, you won't be able to do it easily.</p>
<div class="alert alert-danger">So this is what you should NOT do:</div>
<p>This is a sample controller. It defines a route (<code>get_product?product_id=XXX</code>) that returns HTML data representing
a product and its price. The price is stored without VAT in database and the application must add the VAT to the price.</p>
<pre><code class="language-php">class ProductController
{
    const VAT = 0.2;

    private $dbConnection;

    public function __construct(Connection $dbConnection) {
        $this-&gt;dbConnection = $dbConnection;
    }

    /**
     * This is a sample action based on Splash 8, but this could as well be used in any framework.
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        $productId = $request-&gt;getParams()['product_id'];
        // Let's get the product from database
        $sql = 'SELECT name, price FROM products WHERE id = ?';
        $stmt = $this-&gt;dbConnection-&gt;executeQuery($sql, [ $productId ]);
        $product = $stmt-&gt;fetch(\PDO::FETCH_ASSOC);

        // Let's add the VAT:
        $product['price'] = $product['price'] * (1 + self::VAT); 

        // Let's output some HTML:
        $html = "&lt;p&gt;Product: ".$product['name']."&lt;/p&gt;";
        $html .= "&lt;p&gt;Price: \$".$product['price']."&lt;/p&gt;";
        return new HtmlResponse($html);
    }
}</code></pre>
<p>This code is <strong>wrong</strong> on many aspects.</p>
<ol>
<li>First, it performs a database access in a controller. DB access should be
processed in dedicated classes (and moreover, the developer should consider using an ORM).</li>
<li>It performs business logic, like computing the VAT from the product price.</li>
<li>It generates HTML instead of delegating this to the view component of the framework.</li>
</ol>
<div class="alert alert-success">Instead, the controller should look like this:</div>
<pre><code class="language-php">class ProductController
{
    private $productRepository;
    private $vatService;
    private $twig;

    public function __construct(ProductRepository $productRepository, 
                                VatService $vatService,
                                Twig_Environment $twig) {
        $this-&gt;productRepository = $productRepository;
        $this-&gt;vatService = $vatService;
        $this-&gt;twig = $twig;
    }

    /**
     * This is a sample action based on Splash 8, but this could as well be used in any framework.
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        // The controller is in charge of extracting the parameters from the request.
        $productId = $request-&gt;getParams()['product_id'];
        // The product is fetched from the appropriate service
        // The service should return an *object* representing the product.
        $product = $this-&gt;productRepository-&gt;getProductById($productId);

        // In turn, we can call the VAT service to get the product price with VAT:
        $vat = $this-&gt;vatService-&gt;computeVat($this-&gt;product-&gt;getPrice());

        // Finally, the HTML generation is deferred to a view component. Here, we use Twig:
        $template = $twig-&gt;loadTemplate('product.twig');
        return new HtmlResponse($template-&gt;render([
            'product'=&gt;$product,
            'vat'=&gt;$vat
        ]);
    }
}</code></pre>
<h2 id="stop-using-superglobals-">Stop using superglobals (<code>$_GET</code>, <code>$_POST</code>...)</h2>
<p><span class="label label-success pull-right">Beginner</span></p>
<h3 id="rule-2">Rule</h3>
<div class="alert alert-info">Do not use superglobals like `$_GET`, `$_POST` or `$_REQUEST`.
Instead, use the request object of your framework.</div>
<h3 id="explanation-2">Explanation</h3>
<p>Each MVC framework comes with a <strong>request</strong> object. Modern frameworks should <a href="https://www.php-fig.org/psr/psr-7/">share a common
request object as it has been defined in PSR-7 compatible one</a>.
This request object can be used to access GET and POST parameters.</p>
<p>You should use it instead of accessing <code>$_GET</code>, <code>$_POST</code> or <code>$_REQUEST</code> directly.</p>
<p>This has several advantages:</p>
<ul>
<li>you can unit-test your methods more easily since they do not rely on globals</li>
<li>your framework can enrich the request, apply filters or middleware on it</li>
<li>you can easily fake a request or modify a request</li>
<li>your code is more predictable since only controllers are allowed to use that request object (see next rule)</li>
</ul>
<div class="alert alert-danger">So this is what you should NOT do:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        // NO! You don't access the $_GET superglobal anymore.
        $productId = $_GET['product_id'];

        // Do stuff...
    }
}</code></pre>
<div class="alert alert-success">The correct version of the code is:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        // Yes! we use the $request object to access the GET parameters.
        $productId = $request-&gt;getParams()['product_id'];

        // Do stuff...
    }
}</code></pre>
<h2 id="do-not-pass-the-request-object-to-services">Do not pass the request object to services</h2>
<p><span class="label label-success pull-right">Beginner</span></p>
<h3 id="rule-3">Rule</h3>
<div class="alert alert-info">The request object should stay in your controller.</div>
<h3 id="explanation-3">Explanation</h3>
<p>This object should <strong>stay in the controller</strong>.</p>
<div class="alert alert-danger">So this is what you should NOT do:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        // NO! Do not pass the request to a service or a DAO
        $product = $this-&gt;productRepository-&gt;getProductById($request);

        // Do stuff...
    }
}</code></pre>
<p>The code above is <em>evil</em> because if you want to change the name of a GET parameter in your controller, suddenly, you
have to change the code in your <code>productRepository</code> service. This is obviously wrong, since services are supposed
to be independent from the context in which they run.</p>
<div class="alert alert-success">The correct version of the code is:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /get_product
     */
    public function ajaxGetProductAction(ServerRequestInterface $request): ResponseInterface {
        // The controller is in charge of extracting the parameters from the request.
        $productId = $request-&gt;getParams()['product_id'];
        // The service only takes the necessary parameters
        $product = $this-&gt;productRepository-&gt;getProductById($productId);

        // Do stuff...
    }
}</code></pre>
<h2 id="services-should-not-return-encoded-data">Services should not return encoded data</h2>
<p><span class="label label-success pull-right">Beginner</span></p>
<h3 id="rule-4">Rule</h3>
<div class="alert alert-info">Services should generally return PHP objects. They should not encode data in JSON.
This is the role of the controller.</div>
<h3 id="explanation-4">Explanation</h3>
<p>Data returned by services should be immediately reusable by other services. In PHP, the most usable data representation
is a PHP object, so this is what a service should return.</p>
<p>It is not the role of a service to format the data so that it can be easily sent to the browser. This role of formatting
is usually taken by the controller (or by the view if HTML is returned) </p>
<p>To put things simply: <code>json_encode</code> belongs to the controller.</p>
<div class="alert alert-danger">So this is what you should NOT do:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /products
     */
    public function ajaxGetProducts(ServerRequestInterface $request): ResponseInterface {
        return $this-&gt;productRepository-&gt;getProductList();
    }
}

class ProductRepository
{
    public function getProductList(): ResponseInterface {
        $products = [];
        // Query products in databases
        // ...

        // NO! A service or a DAO should return objects, not encoded strings!
        return json_encode($products);
    }
}</code></pre>
<div class="alert alert-success">The correct version of the code is:</div>
<pre><code class="language-php">class ProductController
{
    // ...

    /**
     * @URL /products
     */
    public function ajaxGetProducts(ServerRequestInterface $request): ResponseInterface {
        // YES! The controller is encoding data in JSON
        // Moreover, it is doing so using a JsonResponse object.
        return new JsonResponse($this-&gt;productRepository-&gt;getProductList());
    }
}

class ProductRepository
{
    /**
     * @return Product[]
     */
    public function getProductList(): array {
        $products = [];
        // Query products in databases
        // ...
        // YES! The service is returning objects.
        return $products;
    }
}</code></pre>

                    <p class="fork-and-edit">
                    Found a typo? Something is wrong in this documentation? Just
                    <a href="https://github.com/thecodingmachine/best-practices/blob/master/php/organize_your_code.md">fork and edit it</a>!
                    </p>
                </div>
            </div>
        </div>
        <div class="img-block">
            <img src="https://bestpractices.thecodingmachine.com/dist/img/image13.jpg" alt="image description">
        </div>
    </main>


    <a href="#0" class="cd-top"></a>
</div> <!--  end wrapper -->
<div class="b-container">
    <div class="container">
        <aside class="row">
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                <strong class="logo"><a href="#"><img src="https://bestpractices.thecodingmachine.com/dist/img/logo.svg" alt="TheCodingMachine"></a></strong>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                <div class="row">
                    <div class="col-lg-5 col-md-6 col-sm-6 col-xs-12">
                        <address>
                            <span class="phone">Phone: <a href="tel:+33171183973">+33 1 71 18 39 73</a></span>
                            <span><a href="mailto:contact@thecodingmachine.com">contact@thecodingmachine.com</a></span>
                            <span class="address">56, rue de Londres<br>	PARIS - 75008<br> France</span>
                        </address>
                    </div>
                    <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12 col-lg-push-4 col-md-push-0 social-area">
                        <a href="https://www.thecodingmachine.com/inside-tcm#rejoindre"><strong class="title">We are hiring!</strong></a>
                        <div class="row" style="margin-top: 45px;">
                            <div class="col-xs-12">
                                <ul class="list-inline social-networks">
                                    <li><a href="https://www.facebook.com/the.coding.machine" target="_blank"><i class="fa fa-facebook fa-lg"></i></a></li>
                                    <li><a href="https://twitter.com/coding_machine" target="_blank"><i class="fa fa-twitter fa-lg"></i></a></li>
                                    <li><a href="https://www.linkedin.com/company/the-coding-machine" target="_blank"><i class="fa fa-linkedin fa-lg"></i></a></li>
                                    <!-- 											<li><a href="https://plus.google.com/104076796617273378986/posts" ><i class="fa fa-google-plus fa-lg"></i></span></a></li> -->
                                </ul>
                                <div class="fb-likes"><div class="fb-like" data-href="https://www.facebook.com/the.coding.machine" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        <footer class="row" id="footer">
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12 col-lg-offset-4 col-md-offset-4 col-sm-offset-4 col-xs-offset-0">
                <span class="copyright">&copy; 2015-2019 <a href="https://www.thecodingmachine.com/">TheCodingMachine</a> - All Rights Reserved</span>
                <span class="design-by">Design by <a href="https://www.allaboutdavid.fr/" target="_blank">All about david</a><br/>
                Powered by <a href="https://couscous.io/">Couscous</a></span>
            </div>
        </footer>
    </div>
</div>
</body>
</html>
